<link rel="import" href="bower_components/polymer/polymer.html">
<dom-module id="type-write-animation">
    <template>
        <style>
         :host {
            display: block;
            color: #334d5c;
        }

        .cursorAnimation {
            -webkit-animation: 1s blink step-end infinite;
            -moz-animation: 1s blink step-end infinite;
            -ms-animation: 1s blink step-end infinite;
            -o-animation: 1s blink step-end infinite;
            animation: 1s blink step-end infinite;
        }

        @keyframes "blink" {
            from,
            to {
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
        }

        @-moz-keyframes blink {
            from,
            to {
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
        }

        @-webkit-keyframes "blink" {
            from,
            to {
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
        }

        @-ms-keyframes "blink" {
            from,
            to {
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
        }

        @-o-keyframes "blink" {
            from,
            to {
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
        }
        </style>
        <!-- Element content -->
        <span style$="color:[[color]];">
            <!-- inline binding for custom css -->
            <span class="wrap" style$="color:[[color]];">
                [[_txt]]
                <span class$="[[animationClass]]" style$="color:[[color]];">[[cursorType]]</span>
            </span>
        </span>
    </template>
    <script>
    Polymer({
        is: 'type-write-animation',
        properties: {
            /* 
            Properties for the Customization of the element
            */

            // Text Array to display
            textArray: {
                type: Array,
                value: function() {
                    return ["The typewrite webcomponent", "Feel free to use & improve this element"]
                }
            },

            // Time untill remove starts (milliseconds)
            timeTillRemove: {
                type: Number,
                value: 800
            },

            // Time untill write starts (milliseconds)
            timeTillWrite: {
                type: Number,
                value: 400
            },

            // Writing speed (milliseconds)
            writeSpeed: {
                type: Number,
                value: 80
            },

            // Remove speed (milliseconds)
            removeSpeed: {
                type: Number,
                value: 3
            },

            // Cursor
            cursorType: {
                type: String,
                value: '|'
            },

            // Togle blinking cursor
            cursorAnimation: {
                type: Boolean,
                value: true,
                observer: '_setCursorAnimation'
            },
            // Cursor and text color (white, rgb(255,255,255, #ffffff)
            color: {
                type: String,
                value: '#334d5c'
            },

            /* 
                Properties that are function related 
            */
            // Array counter
            _loopNum: {
                type: Number,
                value: 0
            },

            // Text item
            _txt: {
                type: String,
                value: ''
            },

            // Deletig state
            _isDeleting: {
                type: Boolean,
                value: false
            },

            // Fully written item
            _fullTxt: {
                type: String
            }
        },

        attached: function() {
            if (this.textArray) {
                this.controllWrite();
            }
        },

        // Controls the write and remove 
        controllWrite: function() {
            var that = this;

            var i = this._loopNum % this.textArray.length;
            if (this._loopNum >= this.textArray.length) {
                this._loopNum = 0;
                var i = this._loopNum % this.textArray.length;
            }
            this._fullTxt = this.textArray[i];


            if (!this._isDeleting && this._txt === this._fullTxt) {
                // text is fully written start deleting
                setTimeout(function() {
                    that._isDeleting = true;
                    that.delete();
                    return
                }, this.timeTillRemove);

            } else if (this._isDeleting && this._txt === '') {
                // text is fully removed start writing the next item
                setTimeout(function() {
                    that._isDeleting = false;
                    that._loopNum++;
                    that.controllWrite();
                    return
                }, this.timeTillWrite);

            } else if (this._isDeleting) {
                // not finished deleting go on
                if (this.removeSpeed <= 1) {
                    var instand = true;
                }
                setTimeout(function() {
                    that.delete(instand);
                    return
                }, this.removeSpeed);

            } else if (!this._isDeleting) {
                // not finished writing go on
                setTimeout(function() {
                    that.write();
                    return
                }, this.writeSpeed);
            }
        },

        // Writes characters 
        write: function() {
            this._txt = this._fullTxt.substring(0, this._txt.length + 1);
            this.controllWrite();
        },

        // Removes characters
        delete: function(instand) {
            if (instand == true) {
                this._txt = '';
            } else {
                this._txt = this._fullTxt.substring(0, this._txt.length - 1);
            }
            this.controllWrite();
        },

        // Toggle the cursor animtion
        _setCursorAnimation: function(animation) {
            if (animation) {
                this.set('animationClass', 'cursorAnimation');
            } else {
                this.set('animationClass', '');
            }
        }

    });
    </script>
</dom-module>